@* 左側欄位清單（欄位、型別、編輯型別） *@

@using ClassLibrary
@model FormFieldListViewModel?

@{
    // 判斷所有欄位目前是否為可編輯或必填，用於決定按鈕文字與下一個狀態
    var allEditable = Model?.Fields?.All(f => f.IS_EDITABLE) ?? false;
    var allRequired = Model?.Fields?.All(f => f.IS_REQUIRED) ?? false;
}

<div class="field-list-container"
     data-master-id="@Model?.ID"
     data-table-name="@Model?.TableName"
     data-schema-type="@((int?)Model?.type)">
    @* 只有 SchemaType 為 OnlyView (1) 時顯示批次設定按鈕 *@
    @if (Model?.type == TableSchemaQueryType.OnlyTable)
    {
        <div class="d-flex justify-content-end mb-2">
            <button type="button"
                    class="btn btn-sm btn-outline-primary me-2"
                    data-editable="@((!allEditable).ToString().ToLower())"
                    onclick="toggleAllEditable(this)">
                @(allEditable ? "全部設為不可編輯" : "全部設為可編輯")
            </button>
            <button type="button"
                    class="btn btn-sm btn-outline-primary"
                    data-required="@((!allRequired).ToString().ToLower())"
                    onclick="toggleAllRequired(this)">
                @(allRequired ? "全部不用必填" : "全部設為必填")
            </button>
        </div>
    }

    <div style="max-height: 400px; overflow-y: auto;">
        <table class="table table-bordered table-striped table-hover align-middle text-sm w-100" style="table-layout: fixed;">
            <thead class="table-light" style="position: sticky; top: 0; z-index: 5;">
            <tr>
                <th style="min-width: 150px;">欄位名稱</th>
                <th style="min-width: 100px;">型別</th>
                <th style="min-width: 150px;">控制元件</th>
            @* <th style="min-width: 60px;">顯示</th> *@
            <th style="min-width: 60px;">必填</th>
            <th style="min-width: 60px;">編輯</th>
            <th style="min-width: 60px;">限制條件</th>
        </tr>
        </thead>
        <tbody>
        @if (Model != null && Model.Fields.Any())
        {
            foreach (var field in Model.Fields)
            {
                var rowClass = field.IS_PK ? "table-secondary" : "";
                <tr class="@rowClass" onclick="loadFieldSetting('@Model.TableName','@field.COLUMN_NAME','@Model.type')" style="cursor:pointer;">
                    <td>@field.COLUMN_NAME</td>
                    <td>@field.DATA_TYPE</td>
                    <td>@(field.CONTROL_TYPE ?? FormControlType.Text)</td>
                    <td>@Html.Raw(field.IS_REQUIRED ? "<i class=\"bi bi-check\"></i>" : "<i class=\"bi bi-x text-danger\"></i>")</td>
                    @* <td>@Html.Raw(field.IS_VISIBLE ? "<i class=\"bi bi-check\"></i>" : "<i class=\"bi bi-x text-danger\"></i>")</td> *@
                    <td>@Html.Raw(field.IS_EDITABLE ? "<i class=\"bi bi-check\"></i>" : "<i class=\"bi bi-x text-danger\"></i>")</td>
                    <td>@Html.Raw(field.IS_VALIDATION_RULE ? "<i class=\"bi bi-check\"></i>" : "<i class=\"bi bi-x text-danger\"></i>")</td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="9" class="text-center text-muted">尚無欄位資料或查無表名</td>
            </tr>
        }
        </tbody>
    </table>
    </div>
</div>
